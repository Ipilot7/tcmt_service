{% extends 'base.html' %}
{% load i18n %}

{% block content %}
<div class="glass-container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="color: white; margin: 0;">ğŸ“‹ {% trans "Requests List" %}</h2>
        {% if user.role != 'user' %}
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'requests:import' %}" class="btn-primary"
                style="text-decoration: none; background-color: #28a745; border-color: #28a745;">
                ğŸ“¥ {% trans "Import" %}
            </a>
            <a href="{% url 'requests:export' %}" class="btn-primary"
                style="text-decoration: none; background-color: #17a2b8; border-color: #17a2b8;">
                ğŸ“¤ {% trans "Export" %}
            </a>
            <a href="{% url 'requests:create' %}" class="btn-primary" style="text-decoration: none;">
                + {% trans "New Request" %}
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Filters -->
    <form method="get" style="margin-bottom: 20px; display: flex; gap: 10px;">
        <input type="text" name="q" placeholder="{% trans 'Search by number...' %}"
            value="{{ request.GET.q|default:'' }}" style="width: 200px; margin: 0;">

        <select name="status" style="width: 200px; margin: 0;" onchange="this.form.submit()">
            <option value="">{% trans "All Statuses" %}</option>
            {% for status in statuses %}
            <option value="{{ status.pk }}" {% if selected_status == status.pk %}selected{% endif %}>
                {{ status.name }}
            </option>
            {% endfor %}
        </select>

        <button type="submit" class="btn-primary" style="padding: 5px 15px;">ğŸ” {% trans "Search" %}</button>

        {% if request.GET.q or request.GET.status %}
        <a href="{% url 'requests:list' %}" class="btn-primary"
            style="background-color: #6c757d; border-color: #6c757d; text-decoration: none; padding: 6px 15px;">
            {% trans "Reset" %}
        </a>
        {% endif %}
    </form>

    <table>
        <thead>
            <tr>
                <th>â„–</th>
                <th>{% trans "Request Number" %}</th>
                <th>{% trans "Date" %}</th>
                <th>{% trans "Institution" %}</th>
                <th>{% trans "Equipment" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Responsible" %}</th>
                <th>{% trans "Actions" %}</th>
            </tr>
        </thead>
        <tbody>
            {% for req in requests %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td><strong>{{ req.request_number }}</strong></td>
                <td>{{ req.created_at|date:"d.m.Y" }}</td>
                <td>
                    {{ req.institution.name }}<br>
                    <span style="font-size: 0.8em; opacity: 0.7;">
                        {{ req.region.name }}
                    </span>
                </td>
                <td>{{ req.equipment_type.name }}</td>
                <td>
                    <span style="padding: 4px 8px; border-radius: 4px;
                                 background: rgba(255,255,255,0.3); font-size: 0.9em;">
                        {{ req.status.name }}
                    </span>
                </td>
                <td>
                    {{ req.responsible.full_name }}<br>
                    <span style="font-size: 0.8em;">
                        {{ req.contact_phone }}
                    </span>
                </td>
                <td>
                    {% if user.role == 'user' and req.status.name in closed_statuses %}
                    <span style="opacity: 0.3; margin-right: 10px;">ğŸ”’</span>
                    {% else %}
                    <a href="{% url 'requests:update' req.pk %}" style="color: white; margin-right: 10px;">âœï¸</a>
                    {% endif %}
                    <a href="{% url 'requests:detail' req.pk %}" style="color: white;">ğŸ‘ï¸</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="8" style="text-align: center; padding: 20px;">
                    {% trans "No requests yet" %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% include 'includes/pagination.html' %}
</div>
{% endblock %}